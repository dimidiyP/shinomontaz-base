#!/usr/bin/env python3

import pymongo
import os

# Connect to MongoDB
mongo_url = os.environ.get('MONGO_URL', 'mongodb://localhost:27017')
client = pymongo.MongoClient(mongo_url)
db = client.tire_storage
pdf_template_collection = db.pdf_template

# Define the full template as seen in the generated PDF
full_template = """–ê–ö–¢ –ü–†–ò–ï–ú–ê –ù–ê –•–†–ê–ù–ï–ù–ò–ï ‚Ññ {record_number}
–≥. –ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥                                  "{created_at}"

–ú—ã, –Ω–∏–∂–µ–ø–æ–¥–ø–∏—Å–∞–≤—à–∏–µ—Å—è:
1. {full_name}, –∏–º–µ–Ω—É–µ–º—ã–π –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º "–ö–ª–∏–µ–Ω—Ç",
2. –û–û–û –†–∏—Ç–µ–π–ª, –∏–º–µ–Ω—É–µ–º—ã–π –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º "–•—Ä–∞–Ω–∏—Ç–µ–ª—å",

—Å–æ—Å—Ç–∞–≤–∏–ª–∏ –Ω–∞—Å—Ç–æ—è—â–∏–π –∞–∫—Ç –æ –Ω–∏–∂–µ—Å–ª–µ–¥—É—é—â–µ–º:

1. –ü–†–ï–î–ú–ï–¢ –ê–ö–¢–ê:
–ö–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–¥–∞–µ—Ç, –∞ –•—Ä–∞–Ω–∏—Ç–µ–ª—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã–µ —à–∏–Ω—ã
–≤ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∏ –Ω–∞ —É—Å–ª–æ–≤–∏—è—Ö, —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –Ω–∏–∂–µ.

2. –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –¢–û–í–ê–†–ï:
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —à–∏–Ω:     {parameters}
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:        {size}
–ê–≤—Ç–æ–º–æ–±–∏–ª—å:        {car_brand}
–¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞:   {phone}
–î–æ–ø. —Ç–µ–ª–µ—Ñ–æ–Ω:      {phone_additional}

3. –£–°–õ–û–í–ò–Ø –•–†–ê–ù–ï–ù–ò–Ø:
–ú–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è: {storage_location}
–°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–≥–æ–≤–æ—Ä—É
–î–∞—Ç–∞ –ø—Ä–∏–µ–º–∞: {created_at}

4. –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–°–õ–û–í–ò–Ø:
–¢–ï–°–¢: –ê–∫—Ç ‚Ññ{record_number} –¥–ª—è {full_name}, —Ç–µ–ª–µ—Ñ–æ–Ω {phone}

–ü–û–î–ü–ò–°–ò –°–¢–û–†–û–ù:

–ö–ª–∏–µ–Ω—Ç:                                           –•—Ä–∞–Ω–∏—Ç–µ–ª—å:"""

print(f"–°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—ã–π —à–∞–±–ª–æ–Ω –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö...")

# Update the template in database
result = pdf_template_collection.update_one(
    {},
    {"$set": {"template": full_template}},
    upsert=True
)

if result.modified_count > 0 or result.upserted_id:
    print("‚úÖ –®–∞–±–ª–æ–Ω —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö!")
else:
    print("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —à–∞–±–ª–æ–Ω–∞")

# Verify the template was saved
template = pdf_template_collection.find_one({})
if template:
    print(f"‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞: —à–∞–±–ª–æ–Ω –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–¥–ª–∏–Ω–∞: {len(template['template'])} —Å–∏–º–≤–æ–ª–æ–≤)")
    print("üìÑ –ù–∞—á–∞–ª–æ —à–∞–±–ª–æ–Ω–∞:")
    print(template['template'][:200] + "...")
else:
    print("‚ùå –®–∞–±–ª–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö!")